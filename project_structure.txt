src/
â”œâ”€â”€ main.ts                                    # ğŸš€ Application entry point
â”œâ”€â”€ app.module.ts                             # ğŸ“¦ Root application module
â”œâ”€â”€ app.controller.ts                         # ğŸ  Basic app controller
â”œâ”€â”€ app.service.ts                            # ğŸ”§ Basic app service
â”‚
â”œâ”€â”€ config/                                   # âš™ï¸ Configuration files
â”‚   â”œâ”€â”€ database.config.ts                    # ğŸ—„ï¸ PostgreSQL connection config
â”‚   â”œâ”€â”€ redis.config.ts                       # ğŸš€ Redis connection config
â”‚   â””â”€â”€ queue.config.ts                       # ğŸ“¨ Bull queue config
â”‚
â”œâ”€â”€ app/                                      # ğŸ  Application bootstrap
â”‚   â”œâ”€â”€ app.module.ts                         # ğŸ“¦ Main app module (imports everything)
â”‚   â”œâ”€â”€ app.controller.ts                     # ğŸ  Health check endpoints
â”‚   â””â”€â”€ app.service.ts                        # ğŸ”§ App-level services
â”‚
â”œâ”€â”€ core/                                     # ğŸ¯ Business logic (latency-critical)
â”‚   â”œâ”€â”€ auth/                                 # ğŸ” Authentication system
â”‚   â”‚   â”œâ”€â”€ auth.module.ts
â”‚   â”‚   â”œâ”€â”€ auth.service.ts
â”‚   â”‚   â”œâ”€â”€ auth.controller.ts
â”‚   â”‚   â”œâ”€â”€ jwt.strategy.ts
â”‚   â”‚   â””â”€â”€ dto/
â”‚   â”‚       â”œâ”€â”€ login.dto.ts
â”‚   â”‚       â””â”€â”€ register.dto.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ user/                                 # ğŸ‘¥ User management
â”‚   â”‚   â”œâ”€â”€ user.module.ts
â”‚   â”‚   â”œâ”€â”€ user.service.ts
â”‚   â”‚   â”œâ”€â”€ user.controller.ts
â”‚   â”‚   â”œâ”€â”€ user-sync.controller.ts          # ğŸ“¡ Sync from main backend
â”‚   â”‚   â”œâ”€â”€ user-sync.service.ts             # ğŸ”„ Sync logic
â”‚   â”‚   â””â”€â”€ dto/
â”‚   â”‚       â”œâ”€â”€ create-user.dto.ts
â”‚   â”‚       â””â”€â”€ update-user.dto.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ session/                              # ğŸª Session management
â”‚   â”‚   â”œâ”€â”€ session.module.ts
â”‚   â”‚   â”œâ”€â”€ session.service.ts
â”‚   â”‚   â”œâ”€â”€ session.controller.ts
â”‚   â”‚   â””â”€â”€ dto/
â”‚   â”‚       â”œâ”€â”€ create-session.dto.ts
â”‚   â”‚       â””â”€â”€ session-response.dto.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ chat/                                 # ğŸ’¬ Real-time chat
â”‚   â”‚   â”œâ”€â”€ chat.module.ts
â”‚   â”‚   â”œâ”€â”€ chat.gateway.ts                   # ğŸŒ WebSocket gateway
â”‚   â”‚   â”œâ”€â”€ chat.service.ts
â”‚   â”‚   â”œâ”€â”€ message.service.ts
â”‚   â”‚   â””â”€â”€ dto/
â”‚   â”‚       â”œâ”€â”€ send-message.dto.ts
â”‚   â”‚       â””â”€â”€ message-response.dto.ts
â”‚   â”‚
â”‚   â””â”€â”€ billing/                              # ğŸ’° Billing system
â”‚       â”œâ”€â”€ billing.module.ts
â”‚       â”œâ”€â”€ billing.service.ts
â”‚       â”œâ”€â”€ billing.controller.ts
â”‚       â””â”€â”€ dto/
â”‚           â”œâ”€â”€ create-transaction.dto.ts
â”‚           â””â”€â”€ billing-response.dto.ts
â”‚
â”œâ”€â”€ infrastructure/                           # ğŸ—ï¸ Infrastructure layer
â”‚   â”œâ”€â”€ database/                             # ğŸ—„ï¸ Database layer
â”‚   â”‚   â”œâ”€â”€ database.module.ts                # ğŸ—ï¸ DB connection & config
â”‚   â”‚   â”œâ”€â”€ database.service.ts               # ğŸ”§ Query optimization & health
â”‚   â”‚   â””â”€â”€ entities/                         # ğŸ“‹ Database entities
â”‚   â”‚       â”œâ”€â”€ user.entity.ts                # ğŸ‘¤ User table schema
â”‚   â”‚       â”œâ”€â”€ session.entity.ts             # ğŸª Session table schema
â”‚   â”‚       â”œâ”€â”€ message.entity.ts             # ğŸ’¬ Message table schema
â”‚   â”‚       â””â”€â”€ billing.entity.ts             # ğŸ’° Transaction table schema
â”‚   â”‚
â”‚   â”œâ”€â”€ cache/                                # ğŸš€ Redis caching
â”‚   â”‚   â”œâ”€â”€ cache.module.ts                   # ğŸ—ï¸ Redis connection
â”‚   â”‚   â”œâ”€â”€ cache.service.ts                  # ğŸ”§ Cache operations
â”‚   â”‚   â””â”€â”€ strategies/                       # ğŸ¯ Cache strategies
â”‚   â”‚       â””â”€â”€ cache-strategies.service.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ messaging/                            # ğŸ“¨ Message queues
â”‚   â”‚   â”œâ”€â”€ messaging.module.ts               # ğŸ—ï¸ Bull queue setup
â”‚   â”‚   â”œâ”€â”€ messaging.service.ts              # ğŸ”§ Queue operations
â”‚   â”‚   â””â”€â”€ processors/                       # âš™ï¸ Queue processors
â”‚   â”‚       â”œâ”€â”€ message.processor.ts          # ğŸ’¬ Message processing
â”‚   â”‚       â”œâ”€â”€ billing.processor.ts          # ğŸ’° Billing processing
â”‚   â”‚       â””â”€â”€ notification.processor.ts     # ğŸ”” Notification processing
â”‚   â”‚
â”‚   â”œâ”€â”€ monitoring/                           # ğŸ“Š Observability
â”‚   â”‚   â”œâ”€â”€ monitoring.module.ts              # ğŸ—ï¸ Prometheus setup
â”‚   â”‚   â”œâ”€â”€ monitoring.service.ts             # ğŸ”§ Metrics collection
â”‚   â”‚   â”œâ”€â”€ health.controller.ts              # ğŸ’š Health check endpoint
â”‚   â”‚   â””â”€â”€ metrics.controller.ts             # ğŸ“Š Metrics endpoint
â”‚   â”‚
â”‚   â””â”€â”€ security/                             # ğŸ›¡ï¸ Security layer
â”‚       â”œâ”€â”€ security.module.ts                # ğŸ—ï¸ Security setup
â”‚       â”œâ”€â”€ security.service.ts               # ğŸ”§ Security utilities
â”‚       â””â”€â”€ rate-limiter.service.ts           # ğŸš¦ Rate limiting
â”‚
â”œâ”€â”€ shared/                                   # ğŸ”§ Shared utilities
â”‚   â”œâ”€â”€ decorators/                           # ğŸ­ Custom decorators
â”‚   â”‚   â”œâ”€â”€ public.decorator.ts               # ğŸŒ Public route decorator
â”‚   â”‚   â””â”€â”€ cache.decorator.ts                # ğŸš€ Cache decorator
â”‚   â”‚
â”‚   â”œâ”€â”€ guards/                               # ğŸ›¡ï¸ Route guards
â”‚   â”‚   â”œâ”€â”€ jwt.guard.ts                      # ğŸ” JWT authentication guard
â”‚   â”‚   â””â”€â”€ role.guard.ts                     # ğŸ‘¥ Role-based access guard
â”‚   â”‚
â”‚   â”œâ”€â”€ interceptors/                         # ğŸ¯ Request interceptors
â”‚   â”‚   â”œâ”€â”€ logging.interceptor.ts            # ğŸ“ Request logging
â”‚   â”‚   â””â”€â”€ timeout.interceptor.ts            # â±ï¸ Request timeout
â”‚   â”‚
â”‚   â”œâ”€â”€ interfaces/                           # ğŸ”— Type definitions
â”‚   â”‚   â”œâ”€â”€ user.interface.ts                 # ğŸ‘¤ User type definitions
â”‚   â”‚   â”œâ”€â”€ session.interface.ts              # ğŸª Session types
â”‚   â”‚   â””â”€â”€ message.interface.ts              # ğŸ’¬ Message types
â”‚   â”‚
â”‚   â””â”€â”€ utils/                                # ğŸ› ï¸ Utility functions
â”‚       â”œâ”€â”€ date.utils.ts                     # ğŸ“… Date helpers
â”‚       â”œâ”€â”€ crypto.utils.ts                   # ğŸ” Crypto helpers
â”‚       â””â”€â”€ validation.utils.ts               # âœ… Validation helpers
â”‚
â””â”€â”€ integrations/                             # ğŸ”— External services
    â”œâ”€â”€ ai/                                   # ğŸ¤– OpenAI integration
    â”œâ”€â”€ video-sdk/                            # ğŸ“¹ Video calling
    â”œâ”€â”€ notifications/                        # ğŸ”” Push notifications
    â””â”€â”€ payment/                              # ğŸ’³ Payment processing







    src/core/
    â”œâ”€â”€ auth/                    # ğŸ” Authentication & Authorization
    â”œâ”€â”€ user/                    # ğŸ‘¤ User Management & Profiles  
    â”œâ”€â”€ billing/                 # ğŸ’° Balance, Transactions & Billing Rules
    â”œâ”€â”€ chat/                    # ğŸ’¬ Real-time Messaging & Chat
    â”œâ”€â”€ session/                 # ğŸ“… Consultation Sessions & Lifecycle
    â””â”€â”€ consultation/            # ğŸ¯ Orchestrator (if needed)


    src/core/billing/
    â”œâ”€â”€ application/
    â”‚   â”œâ”€â”€ interfaces/
    â”‚   â”‚   â”œâ”€â”€ balance.interface.ts           # BalancePort
    â”‚   â”‚   â”œâ”€â”€ billing.interface.ts           # BillingPort
    â”‚   â”‚   â””â”€â”€ payment.interface.ts           # PaymentPort (future)
    â”‚   â”‚
    â”‚   â””â”€â”€ usecaes/
    â”‚       â”œâ”€â”€ get-user-balance.usecase.ts
    â”‚       â”œâ”€â”€ deduct-balance.usecase.ts
    â”‚       â”œâ”€â”€ add-balance.usecase.ts
    â”‚       â”œâ”€â”€ create-transaction.usecase.ts
    â”‚       â”œâ”€â”€ get-transaction-history.usecase.ts
    â”‚       â””â”€â”€ validate-billing.usecase.ts
    â”‚
    â”œâ”€â”€ infrastructure/
    â”‚   â”œâ”€â”€ base-billing.repository.ts
    â”‚   â”œâ”€â”€ balance.repository.ts
    â”‚   â”œâ”€â”€ billing.repository.ts
    â”‚   â””â”€â”€ billing-queue.service.ts          # Queue-based processing
    â”‚
    â”œâ”€â”€ presentation/
    â”‚   â”œâ”€â”€ dto/
    â”‚   â”‚   â”œâ”€â”€ balance.dto.ts
    â”‚   â”‚   â””â”€â”€ billing.dto.ts
    â”‚   â”‚
    â”‚   â””â”€â”€ controllers/
    â”‚       â””â”€â”€ billing.controller.ts
    â”‚
    â”œâ”€â”€ billing.module.ts
    â””â”€â”€ billing.service.ts                    # Real-time billing processor




    src/core/chat/
    â”œâ”€â”€ application/
    â”‚   â”œâ”€â”€ interfaces/
    â”‚   â”‚   â”œâ”€â”€ chat.interface.ts              # ChatPort
    â”‚   â”‚   â”œâ”€â”€ message.interface.ts           # MessagePort
    â”‚   â”‚   â””â”€â”€ room.interface.ts              # RoomPort
    â”‚   â”‚
    â”‚   â””â”€â”€ usecaes/
    â”‚       â”œâ”€â”€ send-message.usecase.ts
    â”‚       â”œâ”€â”€ get-chat-history.usecase.ts
    â”‚       â”œâ”€â”€ create-chat-room.usecase.ts
    â”‚       â”œâ”€â”€ join-chat-room.usecase.ts
    â”‚       â””â”€â”€ mark-messages-read.usecase.ts
    â”‚
    â”œâ”€â”€ infrastructure/
    â”‚   â”œâ”€â”€ base-chat.repository.ts
    â”‚   â”œâ”€â”€ chat.repository.ts
    â”‚   â”œâ”€â”€ message.repository.ts
    â”‚   â”œâ”€â”€ room.repository.ts
    â”‚   â””â”€â”€ websocket/
    â”‚       â”œâ”€â”€ chat.gateway.ts                # Socket.IO for chat
    â”‚       â”œâ”€â”€ chat-events.ts
    â”‚       â””â”€â”€ middleware/
    â”‚           â””â”€â”€ auth.middleware.ts
    â”‚
    â”œâ”€â”€ presentation/
    â”‚   â”œâ”€â”€ dto/
    â”‚   â”‚   â”œâ”€â”€ message.dto.ts
    â”‚   â”‚   â””â”€â”€ room.dto.ts
    â”‚   â”‚
    â”‚   â””â”€â”€ controllers/
    â”‚       â””â”€â”€ chat.controller.ts             # REST endpoints for chat
    â”‚
    â””â”€â”€ chat.module.ts






src/core/session/
â”œâ”€â”€ application/
â”‚   â”œâ”€â”€ interfaces/
â”‚   â”‚   â”œâ”€â”€ session.interface.ts           # SessionPort
â”‚   â”‚   â”œâ”€â”€ waiting-list.interface.ts      # WaitingListPort
â”‚   â”‚   â””â”€â”€ availability.interface.ts      # AvailabilityPort
â”‚   â”‚
â”‚   â””â”€â”€ usecaes/
â”‚       â”œâ”€â”€ create-session.usecase.ts
â”‚       â”œâ”€â”€ join-session.usecase.ts
â”‚       â”œâ”€â”€ end-session.usecase.ts
â”‚       â”œâ”€â”€ manage-waiting-list.usecase.ts
â”‚       â”œâ”€â”€ check-availability.usecase.ts
â”‚       â””â”€â”€ get-session-history.usecase.ts
â”‚
â”œâ”€â”€ infrastructure/
â”‚   â”œâ”€â”€ base-session.repository.ts
â”‚   â”œâ”€â”€ session.repository.ts
â”‚   â”œâ”€â”€ waiting-list.repository.ts
â”‚   â”œâ”€â”€ availability.repository.ts
â”‚   â””â”€â”€ websocket/
â”‚       â”œâ”€â”€ session.gateway.ts             # Socket.IO for sessions
â”‚       â””â”€â”€ events.ts
â”‚
â”œâ”€â”€ presentation/
â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”œâ”€â”€ session.dto.ts
â”‚   â”‚   â””â”€â”€ waiting-list.dto.ts
â”‚   â”‚
â”‚   â””â”€â”€ controllers/
â”‚       â””â”€â”€ session.controller.ts
â”‚
â””â”€â”€ session.module.ts






src/core/user/
â”œâ”€â”€ application/
â”‚   â”œâ”€â”€ interfaces/
â”‚   â”‚   â”œâ”€â”€ user-profile.interface.ts      # âœ… Keep existing
â”‚   â”‚   â”œâ”€â”€ user-lookup.interface.ts       # âœ… Keep existing
â”‚   â”‚   â”œâ”€â”€ sync-user.interface.ts         # âœ… Keep existing
â”‚   â”‚   â””â”€â”€ astrologer.interface.ts        # ğŸ†• Astrologer profiles only
â”‚   â”‚
â”‚   â””â”€â”€ usecaes/
â”‚       â”œâ”€â”€ sync-user.usecase.ts           # âœ… Keep existing
â”‚       â”œâ”€â”€ get-user-profile.usecase.ts    # âœ… Keep existing
â”‚       â”œâ”€â”€ update-user-profile.usecase.ts # âœ… Keep existing
â”‚       â”œâ”€â”€ get-active-astrologers.usecase.ts # âœ… Keep existing
â”‚       â”œâ”€â”€ update-astrologer-profile.usecase.ts # ğŸ†• NEW
â”‚       â””â”€â”€ get-astrologer-profile.usecase.ts    # ğŸ†• NEW
â”‚
â”œâ”€â”€ infrastructure/
â”‚   â”œâ”€â”€ base-user.repository.ts            # âœ… Keep existing
â”‚   â”œâ”€â”€ sync-user.repository.ts            # âœ… Keep existing
â”‚   â”œâ”€â”€ user-profile.repository.ts         # âœ… Keep existing
â”‚   â”œâ”€â”€ user-lookup.repository.ts          # âœ… Keep existing
â”‚   â””â”€â”€ astrologer.repository.ts           # ğŸ†• NEW
â”‚
â”œâ”€â”€ presentation/
â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”œâ”€â”€ sync-user-request.dto.ts       # âœ… Keep existing
â”‚   â”‚   â”œâ”€â”€ update-profile-request.dto.ts  # âœ… Keep existing
â”‚   â”‚   â””â”€â”€ astrologer-profile.dto.ts      # ğŸ†• NEW
â”‚   â”‚
â”‚   â””â”€â”€ controllers/
â”‚       â””â”€â”€ user.controller.ts             # âœ… Keep existing (add astrologer endpoints)
â”‚
â””â”€â”€ user.module.ts                         # âœ… Update with astrologer providers















COMPLETE DATABASE SCHEMA DIAGRAM
Here's the full database diagram with all entities, relationships, and attributes:
ğŸ“Š COMPREHENSIVE ENTITY RELATIONSHIP DIAGRAM
â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚                                       CONSULTATION SYSTEM DATABASE                                              â”‚â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚                                                                                                                 â”‚â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚  â”‚                                 â”‚    â”‚                                  â”‚    â”‚                                 â”‚ â”‚â”‚  â”‚            USERS                â”‚â—„â”€â”€â”€â”¤          USER_PROFILES          â”‚    â”‚     ASTROLOGER_PROFILES       â”‚ â”‚â”‚  â”‚       (Core Identity)           â”‚    â”‚      (Balance & Extended)       â”‚    â”‚    (Rates & Capacity)          â”‚ â”‚â”‚  â”‚                                 â”‚    â”‚                                  â”‚    â”‚                                 â”‚ â”‚â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚            â”‚                                                                                                    â”‚â”‚            â”‚                                                                                                    â”‚â”‚            â–¼                                                                                                    â”‚â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚  â”‚                                 â”‚    â”‚                                  â”‚    â”‚                                 â”‚ â”‚â”‚  â”‚    CONSULTATION_SESSIONS        â”‚â—„â”€â”€â”€â”¤           MESSAGES              â”‚    â”‚   SESSION_PARTICIPANTS        â”‚ â”‚â”‚  â”‚   (Session Metadata & Chat)     â”‚    â”‚      (Persistent Chats)         â”‚    â”‚  (User-Session Links)          â”‚ â”‚â”‚  â”‚                                 â”‚    â”‚                                  â”‚    â”‚                                 â”‚ â”‚â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚                                                                                                                 â”‚â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚  â”‚                                 â”‚    â”‚                                  â”‚    â”‚                                 â”‚ â”‚â”‚  â”‚    BILLING_TRANSACTIONS         â”‚    â”‚           WALLETS               â”‚    â”‚     WALLET_TRANSACTIONS       â”‚ â”‚â”‚  â”‚   (Financial Records)           â”‚    â”‚     (Balance Management)        â”‚    â”‚   (Transaction History)        â”‚ â”‚â”‚  â”‚                                 â”‚    â”‚                                  â”‚    â”‚                                 â”‚ â”‚â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚                                                                                                                 â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ğŸ“‹ COMPLETE TABLE SCHEMAS WITH RELATIONSHIPS
1. USERS (Core User Accounts)
usersâ”œâ”€â”€ id (UUID, PK)â”œâ”€â”€ name (VARCHAR(255))â”œâ”€â”€ email (VARCHAR(255), nullable)â”œâ”€â”€ phone (VARCHAR(20))â”œâ”€â”€ type (ENUM: 'user', 'astrologer')â”œâ”€â”€ status (ENUM: 'active', 'inactive', 'suspended')â”œâ”€â”€ consultation_availability (ENUM: 'available', 'unavailable', 'busy', 'offline')â”œâ”€â”€ session_status (ENUM: 'idle', 'in_session')â”œâ”€â”€ sync_status (ENUM: 'synced', 'pending', 'failed')â”œâ”€â”€ last_sync_at (TIMESTAMP, nullable)â”œâ”€â”€ sync_metadata (JSONB, nullable)â”œâ”€â”€ external_id (VARCHAR(255), UNIQUE)â”œâ”€â”€ created_at (TIMESTAMP)â”œâ”€â”€ updated_at (TIMESTAMP)â””â”€â”€ deleted_at (TIMESTAMP, nullable)RELATIONSHIPS:â”œâ”€â”€ 1:1 â†’ user_profiles (optional)â”œâ”€â”€ 1:1 â†’ astrologer_profiles (if type = 'astrologer')â”œâ”€â”€ 1:1 â†’ wallets (optional)â”œâ”€â”€ 1:many â†’ consultation_sessions (as astrologer)â”œâ”€â”€ 1:many â†’ consultation_sessions (as user)â”œâ”€â”€ 1:many â†’ messages (as sender)â”œâ”€â”€ 1:many â†’ billing_transactionsâ””â”€â”€ 1:many â†’ session_participants
2. USER_PROFILES (Extended User Data)
user_profilesâ”œâ”€â”€ id (UUID, PK)â”œâ”€â”€ user_id (UUID, FK â†’ users.id, UNIQUE)â”œâ”€â”€ current_balance (DECIMAL(10,2))â”œâ”€â”€ total_credited (DECIMAL(10,2))â”œâ”€â”€ total_debited (DECIMAL(10,2))â”œâ”€â”€ balance_updated_at (TIMESTAMP)â”œâ”€â”€ bio (TEXT, nullable)â”œâ”€â”€ avatar_url (TEXT, nullable)â”œâ”€â”€ preferences (JSONB, nullable)â”œâ”€â”€ total_consultations (INT)â”œâ”€â”€ completed_consultations (INT)â”œâ”€â”€ average_rating (DECIMAL(3,2))â”œâ”€â”€ total_ratings (INT)â”œâ”€â”€ created_at (TIMESTAMP)â””â”€â”€ updated_at (TIMESTAMP)RELATIONSHIPS:â””â”€â”€ 1:1 â† users (via user_id)
3. ASTROLOGER_PROFILES (Astrologer-Specific Data)
astrologer_profilesâ”œâ”€â”€ id (UUID, PK)â”œâ”€â”€ astrologer_id (UUID, FK â†’ users.id, UNIQUE)â”œâ”€â”€ chat_rate_per_minute (DECIMAL(10,2))â”œâ”€â”€ call_rate_per_minute (DECIMAL(10,2))â”œâ”€â”€ max_concurrent_sessions (INT)â”œâ”€â”€ last_active_at (TIMESTAMP, nullable)â”œâ”€â”€ performance_metrics (JSONB, nullable)â”œâ”€â”€ specializations (JSONB, nullable)â”œâ”€â”€ monthly_sessions (INT)â”œâ”€â”€ monthly_rating (DECIMAL(3,2))â”œâ”€â”€ created_at (TIMESTAMP)â””â”€â”€ updated_at (TIMESTAMP)RELATIONSHIPS:â””â”€â”€ 1:1 â† users (via astrologer_id, where users.type = 'astrologer')
4. CONSULTATION_SESSIONS (Session Metadata)
consultation_sessionsâ”œâ”€â”€ id (UUID, PK)â”œâ”€â”€ session_type (ENUM: 'chat', 'call')â”œâ”€â”€ status (ENUM: 'waiting', 'active', 'completed', 'cancelled')â”œâ”€â”€ astrologer_id (UUID, FK â†’ users.id)â”œâ”€â”€ user_id (UUID, FK â†’ users.id)â”œâ”€â”€ started_at (TIMESTAMP, nullable)â”œâ”€â”€ ended_at (TIMESTAMP, nullable)â”œâ”€â”€ duration_minutes (INT, nullable)â”œâ”€â”€ total_cost (DECIMAL(10,2), nullable)â”œâ”€â”€ astrologer_rating (DECIMAL(3,2), nullable)â”œâ”€â”€ user_rating (DECIMAL(3,2), nullable)â”œâ”€â”€ session_metadata (JSONB, nullable)â”œâ”€â”€ created_at (TIMESTAMP)â”œâ”€â”€ updated_at (TIMESTAMP)â””â”€â”€ cancelled_at (TIMESTAMP, nullable)RELATIONSHIPS:â”œâ”€â”€ many:1 â†’ users (astrologer via astrologer_id)â”œâ”€â”€ many:1 â†’ users (user via user_id)â”œâ”€â”€ 1:many â†’ messages (via session_id)â”œâ”€â”€ 1:many â†’ session_participants (via session_id)â””â”€â”€ 1:many â†’ billing_transactions (via session_id)
5. MESSAGES (Persistent Chat Messages)
messagesâ”œâ”€â”€ id (UUID, PK)â”œâ”€â”€ session_id (UUID, FK â†’ consultation_sessions.id)â”œâ”€â”€ sender_id (UUID, FK â†’ users.id)â”œâ”€â”€ message_type (ENUM: 'text', 'image', 'file', 'system')â”œâ”€â”€ content (TEXT)â”œâ”€â”€ metadata (JSONB, nullable)â”œâ”€â”€ sent_at (TIMESTAMP)â”œâ”€â”€ delivered_at (TIMESTAMP, nullable)â”œâ”€â”€ read_at (TIMESTAMP, nullable)â”œâ”€â”€ created_at (TIMESTAMP)â””â”€â”€ updated_at (TIMESTAMP)RELATIONSHIPS:â”œâ”€â”€ many:1 â†’ consultation_sessions (via session_id)â””â”€â”€ many:1 â†’ users (via sender_id)
6. SESSION_PARTICIPANTS (User-Session Junction)
session_participantsâ”œâ”€â”€ id (UUID, PK)â”œâ”€â”€ session_id (UUID, FK â†’ consultation_sessions.id)â”œâ”€â”€ user_id (UUID, FK â†’ users.id)â”œâ”€â”€ participant_role (ENUM: 'astrologer', 'user')â”œâ”€â”€ joined_at (TIMESTAMP)â”œâ”€â”€ left_at (TIMESTAMP, nullable)â”œâ”€â”€ connection_status (ENUM: 'connected', 'disconnected', 'reconnecting')â”œâ”€â”€ created_at (TIMESTAMP)â””â”€â”€ updated_at (TIMESTAMP)RELATIONSHIPS:â”œâ”€â”€ many:1 â†’ consultation_sessions (via session_id)â””â”€â”€ many:1 â†’ users (via user_id)CONSTRAINTS:â””â”€â”€ UNIQUE(session_id, user_id) - Prevent duplicate participation
7. WALLETS (Balance Management)
walletsâ”œâ”€â”€ id (UUID, PK)â”œâ”€â”€ user_id (UUID, FK â†’ users.id, UNIQUE)â”œâ”€â”€ current_balance (DECIMAL(10,2))â”œâ”€â”€ available_balance (DECIMAL(10,2))â”œâ”€â”€ held_balance (DECIMAL(10,2))â”œâ”€â”€ currency (VARCHAR(3), default: 'INR')â”œâ”€â”€ status (ENUM: 'active', 'frozen', 'suspended')â”œâ”€â”€ last_transaction_at (TIMESTAMP)â”œâ”€â”€ created_at (TIMESTAMP)â””â”€â”€ updated_at (TIMESTAMP)RELATIONSHIPS:â”œâ”€â”€ 1:1 â† users (via user_id)â””â”€â”€ 1:many â†’ wallet_transactions (via wallet_id)
8. BILLING_TRANSACTIONS (Financial Records)
billing_transactionsâ”œâ”€â”€ id (UUID, PK)â”œâ”€â”€ user_id (UUID, FK â†’ users.id)â”œâ”€â”€ session_id (UUID, FK â†’ consultation_sessions.id, nullable)â”œâ”€â”€ transaction_type (ENUM: 'credit', 'debit', 'refund', 'hold', 'release')â”œâ”€â”€ amount (DECIMAL(10,2))â”œâ”€â”€ currency (VARCHAR(3), default: 'INR')â”œâ”€â”€ description (TEXT, nullable)â”œâ”€â”€ payment_method (VARCHAR(50), nullable)â”œâ”€â”€ external_transaction_id (VARCHAR(255), nullable)â”œâ”€â”€ status (ENUM: 'pending', 'completed', 'failed', 'cancelled')â”œâ”€â”€ processed_at (TIMESTAMP, nullable)â”œâ”€â”€ created_at (TIMESTAMP)â””â”€â”€ updated_at (TIMESTAMP)RELATIONSHIPS:â”œâ”€â”€ many:1 â†’ users (via user_id)â””â”€â”€ many:1 â†’ consultation_sessions (via session_id, optional)
9. WALLET_TRANSACTIONS (Detailed Wallet History)
wallet_transactionsâ”œâ”€â”€ id (UUID, PK)â”œâ”€â”€ wallet_id (UUID, FK â†’ wallets.id)â”œâ”€â”€ transaction_type (ENUM: 'deposit', 'withdrawal', 'transfer', 'fee', 'refund')â”œâ”€â”€ amount (DECIMAL(10,2))â”œâ”€â”€ balance_before (DECIMAL(10,2))â”œâ”€â”€ balance_after (DECIMAL(10,2))â”œâ”€â”€ description (TEXT, nullable)â”œâ”€â”€ reference_id (VARCHAR(255), nullable)â”œâ”€â”€ created_at (TIMESTAMP)â””â”€â”€ updated_at (TIMESTAMP)RELATIONSHIPS:â””â”€â”€ many:1 â†’ wallets (via wallet_id)
ğŸ”— RELATIONSHIP SUMMARY
One-to-One Relationships:
users â†” user_profiles
users â†” astrologer_profiles (conditional)
users â†” wallets (optional)
One-to-Many Relationships:
users â†’ consultation_sessions (multiple sessions per user)
users â†’ messages (multiple messages per user)
users â†’ billing_transactions (transaction history)
consultation_sessions â†’ messages (chat history)
consultation_sessions â†’ session_participants (session members)
wallets â†’ wallet_transactions (transaction log)
Many-to-Many (via Junction):
users â†” consultation_sessions (via session_participants)
ğŸ¯ KEY ARCHITECTURAL PRINCIPLES
Separation of Concerns: Core identity vs. extended data vs. transactions
Normalized Design: Avoid data duplication
Complete Audit Trail: Financial and communication history
Scalable Structure: Different tables for different access patterns
Flexible Schema: JSONB fields for dynamic requirements
This is your complete, production-ready database schema! ğŸš€
Does this comprehensive diagram answer your question about the full database structure?